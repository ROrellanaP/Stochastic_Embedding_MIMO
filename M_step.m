function est_param=M_step(N,M,K,Estep_param,mu_m,n_delta,theta_m,Phi,Psi,Y)
id3183422914=Estep_param.zita_hat;
id75281933=Estep_param.mu_tilde;
id2904044764=Estep_param.sigma_tilde;

for id4247002399=1:K
    id2447073414=squeeze(id75281933(:,id4247002399,:)).*(id3183422914(id4247002399,:));

    id414066=id75281933(:,id4247002399,:)-mu_m(:,id4247002399);
    id863606284=reshape(id414066,1,n_delta,M);
    id414066=pagemtimes(id414066,id863606284);
    id899917316=(id414066(:,:,:)+reshape(id2904044764(:,:,id4247002399,:),n_delta,n_delta,M)).*(reshape(id3183422914(id4247002399,:),1,1,M));
    id2233968082=sum(id3183422914(id4247002399,:));

    id1053698041(id4247002399,1)=sum(id3183422914(id4247002399,:))/M;

    %---------------------------------
    % Compute theta
    %---------------------------------
    id348654705(:,:,:,id4247002399)=(pagemtimes(pagetranspose(Phi(:,:,:)),Phi(:,:,:))).*reshape(id3183422914(id4247002399,:),1,1,M);
    id2412933560(:,:,:,id4247002399)=(pagemtimes(pagetranspose(Phi(:,:,:)),(reshape(Y,N,1,M)-pagemtimes(Psi(:,:,:),id75281933(:,id4247002399,:)))))...
           .*reshape(id3183422914(id4247002399,:),1,1,M);

    %------------------------------------

    id4074941307(:,id4247002399)=sum(id2447073414,2)/id2233968082;
    id2233145948(:,:,id4247002399)=diag(diag(sum(id899917316,3)/id2233968082));
  %  sigma_m1(:,:,j)=sum(aux2,3)/Daux;

    %------------------------------------------
    % Compute sigma_w
    %--------------------------------------------
    
    for id3511877123=1:M
        id3941826462=(Y(:,id3511877123)-Phi(:,:,id3511877123)*theta_m-Psi(:,:,id3511877123)*id75281933(:,id4247002399,id3511877123));
        id3532901442(id4247002399,id3511877123)=((id3941826462.')*(id3941826462)+trace(Psi(:,:,id3511877123)*id2904044764(:,:,id4247002399,id3511877123)*(Psi(:,:,id3511877123).')))*id3183422914(id4247002399,id3511877123);
    end
    %-------------------------------------------------
end
id92476795=sum(sum(id3532901442))/(N*M);
id2712443958=(sum(sum(id348654705,4),3))\(sum(sum(id2412933560,4),3));

est_param.mu_m1=id4074941307;
est_param.sigma_m1=id2233145948;
est_param.sigmaw_m1=id92476795;
est_param.theta_m1=id2712443958;
est_param.alpha_m1=id1053698041;
end